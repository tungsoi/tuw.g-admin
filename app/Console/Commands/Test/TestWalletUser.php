<?php

namespace App\Console\Commands\Test;

use App\Admin\Services\UserService;
use App\Models\PaymentOrder\PaymentOrder;
use App\Models\PurchaseOrder\PurchaseOrder;
use App\Models\PurchaseOrder\PurchaseOrderItem;
use App\Models\SaleReport\ReportDetail;
use App\Models\SyncData\AlilogiTransaction;
use App\Models\SyncData\AlilogiUser;
use App\Models\System\Transaction;
use App\Models\TransportOrder\TransportCode;
use App\User;
use Illuminate\Console\Command;
use Illuminate\Support\Facades\Storage;

class TestWalletUser extends Command
{
    /**
     * The name and signature of the console command.
     *
     * @var string
     */
    protected $signature = 'test';

    /**
     * The console command description.
     *
     * @var string
     */
    protected $description = 'Command description';

    /**
     * Create a new command instance.
     *
     * @return void
     */
    public function __construct()
    {
        parent::__construct();
    }

    /**
     * Execute the console command.
     *
     * @return mixed
     */
    public function handle()
    {   
        ini_set('memory_limit', '6400M');

        $items = PurchaseOrderItem::whereNotNull('outstock_at')
        ->whereBetween('outstock_at', ['2021-11-01 00:00:01', '2021-11-30 23:59:59'])
        ->with('order')
        ->get();

        $orders = [];
        foreach ($items as $item) {
          $item_outstock = date('d-m-Y', strtotime($item->outstock_at));
          $order_success = date('d-m-Y', strtotime($item->order->success_at));
          if ($item->order->status == 9 && ($item_outstock >= $order_success)) {
            $orders[$item->order->id] = $item->order->id;
            // if ($item->order->totalItems() == $item->order->items->where('status', 4)->count()) {
            //   $orders[$item->order->id] = $item->order->orderEmployee->name;
            // }
          }
        }


        $data = PurchaseOrder::whereIn('id', $orders)->with('items')->get();

        $key = 1;
        foreach ($data as $order) {
          $total_items = $order->items->count();
          $total_outstock_items = $order->items()->where('status', 4)->count();

          if ($order->order_number == 'MH-D0218') {
            dd($total_items."-".$total_outstock_items);
          }
          if ($total_items == $total_outstock_items) {
            echo $key . " - ". $order->order_number . " - Tổng sản phẩm: " . $total_items . " - Hết hàng: " . $total_outstock_items . " - NV Order: " . $order->orderEmployee->name.  "\n"; 
            $key++;
          }
        }
        // $orders = PurchaseOrder::whereBetween('success_at', ['2021-11-01 00:00:01', '2021-11-30 23:59:59'])
        // ->with('items')
        // ->get();

        // foreach ($orders as $order) {
        //   foreach 
        // }

        // dd(sizeof($orders));
        dd('-');
        $customers = User::where('symbol_name', 'like', 'TX%')->with('transactions')->get();

        foreach ($customers as $customer) {
          echo $customer->symbol_name . "\n";
          $service = new UserService();
          $res = $service->GetCustomerTransactionHistory($customer->id, false);

          foreach ($res as $value) {
            dd($value['after_payment']);
            if (strpos($value['after_payment'], '407') !== false) {
              echo 'true';
            }
          }

          // dd($res);
        }
        dd($customers->count());
        $orders = PurchaseOrder::whereIn('status', [5, 7, 9])->with('items')->orderBy('id', 'desc')
        ->where('created_at', '>', '2021-08-01')
        ->get();

        foreach ($orders as $order) {

          if ($order->sumItemPrice() == 0) {
            echo $order->order_number . "\n";
          }

        }
        dd($orders->count());
        $data = [
            0 =>  [
              "user_name" => "Công ty",
              "user_id" => 4138,
              "total_transport_weight" => 23070.5,
              "total_transport_m3" => 40.004,
              "total_transport_fee" => 558360910,
              "total_transport_weight_new_customer" => 0,
              "total_transport_fee_new_customer" => 0,
              "customer_id" => "[422,424,425,426,427,428,430,431,433,434,435,436,437,438,439,441,442,444,445,446,447,448,449,451,452,454,455,456,459,461,462,464,465,466,467,469,470,471,473,475,476,477,478,479,480,483,485,486,487,488,489,491,492,494,495,496,497,499,500,502,504,505,506,508,509,510,511,512,513,514,515,516,517,518,520,521,522,523,525,526,527,528,529,530,531,534,535,537,538,539,540,541,542,543,545,546,547,548,552,553,554,555,556,557,558,561,562,563,564,569,574,575,577,579,580,582,584,586,587,588,589,590,592,594,595,597,598,600,601,603,604,605,606,609,610,612,613,614,615,616,617,618,619,620,621,622,623,624,625,626,627,628,629,630,631,634,635,636,637,639,640,641,642,643,644,645,646,647,648,650,651,653,654,655,656,658,659,660,661,662,663,664,665,667,668,669,670,671,672,673,674,675,677,678,679,680,1000,1003,1004,1009,1013,1017,1018,1023,1029,1030,1031,1032,1037,1039,1040,1041,1042,1051,1054,1055,1057,1061,1062,1064,1065,1068,1070,1071,1076,1078,1079,1085,1087,1088,1098,1101,1103,1104,1106,1107,1109,1110,1111,1112,1113,1114,1115,1116,1117,1120,1122,1123,1124,1125,1126,1127,1130,1137,1139,1142,1143,1147,1151,1152,1154,1157,1158,1160,1163,1164,1165,1166,1167,1169,1170,1172,1175,1176,1177,1180,1181,1182,1184,1185,1187,1188,1189,1191,1195,1196,1197,1198,1199,1200,1201,1202,1203,1205,1206,1207,1208,1210,1211,1212,1213,1215,1216,1217,1218,1219,1222,1223,1224,1225,1226,1227,1228,1229,1231,1232,1234,1235,1239,1240,1241,1244,1245,1246,1247,1249,1251,1252,1255,1256,1257,1258,1259,1260,1261,1262,1263,1264,1266,1267,1268,1269,1271,1274,1275,1276,1277,1278,1279,1280,1281,1282,1283,1284,1285,1287,1288,1290,1292,1295,1297,1299,1300,1302,1303,1305,1306,1309,1310,1317,1319,1321,1323,1327,1336,1339,1341,1342,1343,1344,1345,1346,1351,1357,1358,1369,1371,1374,1375,1379,1380,1388,1392,1396,1397,1404,1405,1406,1409,1412,1413,1414,1416,1418,1421,1422,1425,1430,1439,1440,1442,1444,1445,1454,1455,1456,1457,1465,1471,1472,1473,1478,1479,1483,1484,1486,1493,1496,1497,1502,1507,1508,1512,1515,1520,1524,1525,1527,1528,1530,1531,1532,1536,1541,1542,1543,1545,1554,1560,1561,1562,1563,1565,1566,1567,1570,1571,1572,1573,1576,1578,1582,1583,1584,1587,1588,1589,1591,1592,1594,1595,1596,1597,1599,1601,1602,1603,1604,1607,1608,1609,1610,1611,1614,1618,1620,1622,1624,1625,1626,1627,1630,1631,1636,1638,1639,1642,1647,1650,1652,1654,1655,1660,1664,1665,1667,1668,1669,1671,1673,1675,1679,1684,1685,1694,1695,1697,1698,1699,1700,1701,1705,1710,1711,1715,1716,1717,1722,1725,1730,1733,1734,1737,1739,1740,1741,1743,1744,1745,1746,1748,1751,1752,1753,1756,1758,1762,1763,1764,1765,1767,1772,1773,1780,1781,1783,1784,1785,1787,1788,1789,1790,1793,1795,1797,1798,1799,1800,1803,1804,1805,1807,1808,1809,1811,1812,1813,1814,1815,1816,1817,1818,1819,1822,1823,1824,1825,1826,1827,1828,1829,1831,1832,1833,1834,1835,1839,1840,1841,1842,1845,1851,1852,1853,1856,1859,1860,1862,1863,1864,1866,1867,1872,1873,1874,1876,1877,1886,1888,1897,1900,1904,1906,1909,1911,1912,1917,1919,1923,1924,1926,1927,1930,1933,1934,1937,1938,1939,1940,1941,1942,1943,1947,1948,1949,1951,1956,1970,1971,1974,1975,1976,1977,1978,1983,1989,1991,1994,1996,1999,2000,2001,2007,2008,2009,2012,2013,2015,2018,2019,2020,2021,2029,2034,2039,2046,2047,2048,2051,2053,2055,2056,2062,2063,2066,2068,2072,2073,2075,2076,2078,2079,2086,2087,2088,2094,2105,2108,2117,2118,2121,2122,2127,2128,2132,2135,2149,2150,2151,2154,2155,2158,2170,2176,2177,2178,2184,2185,2189,2196,2197,2204,2212,2213,2214,2220,2222,2229,2232,2234,2235,2241,2242,2253,2257,2260,2261,2265,2268,2269,2271,2281,2283,2285,2296,2297,2299,2303,2315,2316,2319,2320,2321,2325,2327,2332,2335,2336,2344,2351,2372,2373,2386,2390,2395,2416,2417,2424,2434,2443,2445,2447,2452,2456,2460,2461,2462,2463,2466,2471,2472,2475,2478,2479,2481,2493,2495,2497,2500,2503,2504,2508,2511,2527,2531,2532,2535,2540,2548,2550,2551,2552,2556,2557,2558,2562,2569,2577,2587,2591,2594,2604,2611,2613,2614,2618,2619,2624,2625,2626,2633,2635,2637,2643,2647,2655,2662,2666,2672,2673,2680,2697,2707,2708,2712,2714,2723,2736,2738,2741,2744,2754,2755,2758,2766,2779,2782,2784,2786,2796,2804,2807,2813,2832,2839,2840,2849,2866,2874,2879,2881,2883,2889,2927,2936,2940,2942,2943,2947,2956,2957,2958,2972,2979,2980,2981,2982,2983,2995,3007,3008,3009,3016,3017,3019,3021,3025,3026,3043,3047,3060,3063,3064,3071,3072,3082,3097,3103,3113,3131,3147,3152,3157,3161,3176,3198,3209,3216,3222,3223,3234,3240,3241,3265,3284,3291,3332,3337,3346,3348,3353,3354,3357,3359,3363,3364,3380,3406,3407,3416,3437,3459,3468,3478,3492,3493,3496,3509,3514,3519,3520,3531,3539,3559,3561,3564,3573,3585,3588,3589,3597,3600,3604,3608,3610,3616,3619,3638,3643,3645,3646,3657,3671,3674,3675,3687,3703,3704,3715,3718,3730,3731,3733,3737,3739,3748,3753,3769,3783,3794,3805,3820,3831,3839,3854,3855,3864,3876,3880,3884,3887,3902,3904,3905,3906,3912,3916,3926,3930,3933,3935,3936,3937,3938,3939,3940,3941,3942,3943,3945,3947,3953,3955,3956,3960,3962,3965,3967,3971,3982,3987,3990,3991,4000,4001,4006,4010,4013,4015,4016,4017,4026,4034,4036,4041,4042,4045,4050,4053,4054,4057,4059,4060,4062,4064,4065,4068,4071,4072,4075,4082,4087,4097,4099,4103,4104,4111,4112,4114,4115,4121,4126,4130,4133,4134,4139,4141,4142,4143,4155,4161,4165,4166,4167,4176,4186,4187,4194,4196,4201,4208,4215,4221,4225,4241,4242,4246,4247,4259,4268,4276,4280,4287,4297,4298,4303,4306,4307,4310,4318,4320,4329,4346,4353,4354,4355,4356,4361,4362,4363,4366,4368,4372,4375,4376,4386,4390,4394,4395,4403,4404,4411,4415,4418,4421,4423,4424,4426,4428,4437,4440,4442,4448,4453,4454,4473,4480,4484,4485,4492,4494,4496,4497,4498,4500,4501,4508,4521,4522,4523,4542,4543,4550,4551,4559,4560,4561,4570,4572,4573,4580,4589,4592,4593,4597,4599,4600,4601,4604,4609,4618,4619,4621,4640,4642,4645,4646,4648,4653,4654,4655,4661,4662,4667,4669,4670,4673,4675,4677,4678,4682,4683,4686,4691,4692,4696]"
            ],
            1 =>  [
              "user_name" => "Nguyễn Hoàng Hiệp",
              "user_id" => 4135,
              "total_transport_weight" => 108.1,
              "total_transport_m3" => 4.16,
              "total_transport_fee" => 15674120,
              "total_transport_weight_new_customer" => 0,
              "total_transport_fee_new_customer" => 0,
              "customer_id" => "[2382,4136,4164,4168,4203,4210,4211,4222,4228,4234,4238,4245,4253,4265,4269,4273,4286,4292,4296,4311,4315,4317,4323,4324,4331,4333,4342,4349,4358,4373,4383,4388,4401,4417,4434,4443,4444,4450,4452,4466,4471,4475,4476,4478,4481,4486,4488,4489,4491,4499,4502,4509,4512,4516,4520,4524,4529,4535,4536,4541,4552,4557,4564,4611,4613,4615,4644,4649,4656,4674,4676,4679,4688,4690,4698,4704,4714,4724,4725,4727]"
            ],
            2 =>  [
              "user_name" => "Hoàng Tuấn Anh",
              "user_id" => 4049,
              "total_transport_weight" => 136.1,
              "total_transport_m3" => 0.043,
              "total_transport_fee" => 4093099,
              "total_transport_weight_new_customer" => 0,
              "total_transport_fee_new_customer" => 0,
              "customer_id" => "[559,1516,1870,2067,2640,3349,4106,4195,4202,4219,4227,4295,4302,4309,4312,4322,4336,4341,4364,4369,4371,4377,4380,4381,4382,4407,4410,4511,4519,4546,4569,4578,4608,4628,4632,4634,4650,4657,4664,4666,4687,4693,4708,4715]"
            ],
            3 =>  [
              "user_name" => "HOÀNG DIỆU LY",
              "user_id" => 3977,
              "total_transport_weight" => 6.5,
              "total_transport_m3" => 0,
              "total_transport_fee" => 245100,
              "total_transport_weight_new_customer" => 0,
              "total_transport_fee_new_customer" => 0,
              "customer_id" => "[4119,4160,4188,4190,4217,4223,4243,4248]"
            ],
            4 =>  [
              "user_name" => "NGUYỄN THANH BÌNH-0865552095",
              "user_id" => 3976,
              "total_transport_weight" => 470.3,
              "total_transport_m3" => 0.041,
              "total_transport_fee" => 12394100,
              "total_transport_weight_new_customer" => 0,
              "total_transport_fee_new_customer" => 0,
              "customer_id" => "[1194,1687,2157,2187,2639,3144,3861,3952,4055,4058,4077,4088,4101,4118,4120,4124,4125,4152,4170,4173,4185,4189,4252,4254,4261,4275,4283,4289,4299,4392,4402,4469,4474,4503,4510,4518,4537,4636,4651,4658,4689]"
            ],
            5 =>  [
              "user_name" => "HOÀNG HUY - 0865797897",
              "user_id" => 3975,
              "total_transport_weight" => 7.3,
              "total_transport_m3" => 0,
              "total_transport_fee" => 211700,
              "total_transport_weight_new_customer" => 0,
              "total_transport_fee_new_customer" => 0,
              "customer_id" => "[524,1133,1155,1389,1466,2458,4204,4547,4549,4620,4697]"
            ],
            6 =>  [
              "user_name" => "Dzung",
              "user_id" => 3974,
              "total_transport_weight" => 1011.9,
              "total_transport_m3" => 0,
              "total_transport_fee" => 17308250,
              "total_transport_weight_new_customer" => 0,
              "total_transport_fee_new_customer" => 0,
              "customer_id" => "[3489,3979,3980,4712]"
            ],
            7 =>  [
              "user_name" => "CSKH Kho Thanh Xuân",
              "user_id" => 3919,
              "total_transport_weight" => 264.5,
              "total_transport_m3" => 0,
              "total_transport_fee" => 3387000,
              "total_transport_weight_new_customer" => 0,
              "total_transport_fee_new_customer" => 0,
              "customer_id" => "[3996,4263,4528,4707]",
            ],
            8 =>  [
              "user_name" => "CSKH Kho Hai Bà Trưng",
              "user_id" => 3911,
              "total_transport_weight" => 1378.6,
              "total_transport_m3" => 1.165,
              "total_transport_fee" => 43595646,
              "total_transport_weight_new_customer" => 0,
              "total_transport_fee_new_customer" => 0,
              "customer_id" => "[421,432,457,458,463,482,484,493,498,507,519,536,544,549,578,583,591,593,599,608,611,633,638,1024,1052,1099,1453,1586,1628,1662,1666,1672,1696,1724,1761,1846,1992,2256,2450,2454,2748,3697,3750,3927,3948,3981,4035,4047,4070,4256,4257,4271,4285,4365,4427,4435,4505,4517,4530,4554,4586,4591,4626,4663,4680,4681]"
            ],
            9 =>  [
              "user_name" => "Vũ Thị Huyền-0328394230",
              "user_id" => 3711,
              "total_transport_weight" => 589.7,
              "total_transport_m3" => 1.226,
              "total_transport_fee" => 21324098,
              "total_transport_weight_new_customer" => 0,
              "total_transport_fee_new_customer" => 0,
              "customer_id" => "[1,1333,1766,1889,1895,3212,3335,3452,3465,3728,3740,3741,3742,3747,3749,3756,3758,3761,3763,3764,3765,3767,3768,3773,3778,3782,3787,3790,3791,3795,3799,3806,3810,3811,3816,3817,3818,3819,3823,3827,3829,3832,3833,3834,3836,3842,3846,3847,3852,3857,3862,3863,3878,3893,3897,3910,3913,3923,3944,3970,3984,3988,3989,3992,3994,3995,4004,4005,4011,4025,4037,4039,4044,4076,4090,4140,4146,4147,4183,4184,4209,4213,4239,4262,4278,4314,4345,4351,4374,4400,4457,4464,4467,4470,4514,4533,4538,4587,4602,4605,4617,4641,4701,4721]"
            ],
            10 =>  [
              "user_name" => "NGUYỄN DUY NGỌC UYÊN",
              "user_id" => 3042,
              "total_transport_weight" => 174.6,
              "total_transport_m3" => 0.049,
              "total_transport_fee" => 5638398,
              "total_transport_weight_new_customer" => 0,
              "total_transport_fee_new_customer" => 0,
              "customer_id" => "[1129,1233,1293,1649,2159,2228,2391,2436,2526,2729,2732,2969,3059,3067,3090,3101,3116,3117,3119,3126,3128,3136,3137,3145,3151,3167,3170,3180,3187,3193,3199,3217,3224,3230,3236,3274,3287,3288,3294,3296,3299,3319,3329,3334,3340,3341,3344,3368,3371,3376,3381,3386,3396,3397,3403,3405,3408,3425,3427,3432,3434,3442,3444,3467,3541,3601,3606,3636,3641,3651,3659,3686,3689,3699,3716,3732,3745,3751,3752,3781,3785,3797,3815,3835,3838,3845,3849,3869,3873,3889,3921,3922,3931,3934,3964,4066,4089,4107,4122,4159,4169,4172,4205,4206,4216,4224,4235,4284,4357,4359,4391,4429,4432,4456,4463,4504,4544,4553,4622,4623,4624,4625,4635,4671,4699,4702,4705]"
            ],
            11 =>  [
              "user_name" => "Mai Thu Phương",
              "user_id" => 2955,
              "total_transport_weight" => 1223.1,
              "total_transport_m3" => 0.469,
              "total_transport_fee" => 25278996,
              "total_transport_weight_new_customer" => 0,
              "total_transport_fee_new_customer" => 0,
              "customer_id" => "[1402,1506,1590,1600,1613,1944,2252,2305,2307,2311,2368,2389,2412,2444,2545,2703,2759,2990,3001,3002,3004,3012,3027,3030,3031,3032,3098,3105,3127,3166,3175,3178,3188,3195,3197,3218,3226,3228,3243,3271,3277,3280,3300,3309,3330,3411,3413,3415,3439,3449,3450,3517,3521,3527,3533,3550,3572,3578,3579,3580,3609,3655,3656,3680,3682,3684,3723,3757,3774,3788,3813,3859,3860,3896,4052,4074,4080,4081,4095,4117,4153,4171,4174,4175,4177,4193,4198,4207,4212,4229,4230,4240,4258,4260,4330,4339,4347,4360,4385,4398,4419,4431,4455,4459,4460,4465,4468,4482,4487,4490,4527,4540,4558,4562,4579,4583,4606,4631,4639,4643]"
            ],
            12 =>  [
              "user_name" => "LÊ T. THUỲ LINH",
              "user_id" => 2814,
              "total_transport_weight" => 292.4,
              "total_transport_m3" => 0.0,
              "total_transport_fee" => 8563400,
              "total_transport_weight_new_customer" => 0,
              "total_transport_fee_new_customer" => 0,
              "customer_id" => "[1238,1915,1916,2111,2115,2375,2730,2821,2829,2846,2891,2893,2898,2918,2923,2962,2963,2967,3015,3018,3023,3053,3118,3148,3171,3190,3225,3268,3270,3276,3282,3317,3318,3324,3387,3401,3455,3456,3457,3460,3477,3499,3535,3536,3562,3596,3635,3639,3648,3653,3658,3713,3738,3784,3895,3978,4031,4033,4040,4100,4109,4149,4150,4156,4158,4180,4232,4236,4288,4291,4294,4300,4308,4393,4406,4430,4441,4445,4446,4513,4531,4556,4567,4574,4647,4668]"
            ],
            13 =>  [
              "user_name" => "Vũ Ngọc Châu",
              "user_id" => 2728,
              "total_transport_weight" => 224.0,
              "total_transport_m3" => 0.202,
              "total_transport_fee" => 6895799,
              "total_transport_weight_new_customer" => 0,
              "total_transport_fee_new_customer" => 0,
              "customer_id" => "[1513,2173,2308,2602,2873,3159,3163,3164,3165,3173,3179,3185,3192,3205,3208,3214,3219,3235,3247,3248,3249,3253,3261,3283,3308,3320,3325,3336,3361,3365,3366,3369,3372,3404,3428,3429,3448,3487,3491,3503,3511,3515,3558,3584,3587,3599,3611,3621,3672,3673,3677,3853,3856,3949,3968,3986,4007,4267,4396,4439,4700]"
            ],
            14 =>  [
              "user_name" => "Nguyễn Huyền Trang",
              "user_id" => 2578,
              "total_transport_weight" => 819.0,
              "total_transport_m3" => 0.783,
              "total_transport_fee" => 27268096,
              "total_transport_weight_new_customer" => 0,
              "total_transport_fee_new_customer" => 0,
              "customer_id" => "[1294,1979,2597,2607,2622,2636,2642,2644,2653,2661,2667,2670,2675,2679,2690,2701,2704,2709,2710,2711,2715,2717,2718,2719,2724,2731,2734,2746,2753,2760,2767,2771,2785,2793,2797,2798,2799,2800,2808,2810,2812,2831,2833,2859,2861,2871,2885,2887,2888,2890,2899,2921,2924,2926,2937,2941,2944,2946,2948,2964,2965,2986,2993,3011,3050,3078,3081,3085,3093,3112,3132,3133,3146,3232,3239,3252,3293,3310,3311,3316,3323,3358,3382,3391,3393,3398,3409,3410,3414,3420,3421,3422,3431,3433,3436,3440,3451,3464,3473,3474,3482,3483,3484,3495,3497,3498,3500,3501,3513,3522,3523,3524,3528,3530,3534,3537,3538,3540,3544,3546,3547,3549,3552,3555,3560,3563,3565,3566,3567,3570,3574,3575,3577,3581,3582,3590,3595,3614,3615,3617,3618,3622,3623,3625,3626,3631,3647,3663,3664,3669,3670,3676,3681,3685,3688,3694,3695,3696,3698,3705,3706,3707,3708,3710,3712,3725,3726,3746,3754,3755,3759,3772,3798,3801,3808,3821,3824,3825,3826,3830,3843,3874,3891,3898,3900,3901,3903,3907,3908,3909,3915,3928,3929,3946,3961,3972,4002,4003,4020,4024,4032,4038,4043,4083,4092,4098,4102,4116,4148,4154,4162,4192,4218,4237,4264,4266,4272,4274,4325,4335,4343,4348,4387,4408,4409,4416,4420,4422,4449,4458,4477,4479,4483,4493,4525,4526,4534,4548,4566,4571,4581,4582,4584,4594,4603,4616,4665,4684,4685,4695,4710,4719]"
            ],
            15 =>  [
              "user_name" => "Lại Huy Chung",
              "user_id" => 2455,
              "total_transport_weight" => 595.1,
              "total_transport_m3" => 0.18,
              "total_transport_fee" => 21939600,
              "total_transport_weight_new_customer" => 0,
              "total_transport_fee_new_customer" => 0,
              "customer_id" => "[2205,2565,2774,2783,2787,2824,2836,2838,2845,2867,2878,2880,2882,2886,2894,2901,2910,2916,2920,2928,2932,2938,2939,2973,2992,2997,3000,3005,3048,3062,3065,3102,3106,3120,3122,3130,3153,3154,3155,3156,3168,3169,3215,3221,3229,3231,3233,3242,3251,3259,3264,3269,3272,3273,3278,3290,3302,3305,3306,3307,3313,3326,3333,3342,3347,3350,3375,3389,3392,3395,3400,3447,3454,3466,3469,3471,3485,3504,3526,3532,3557,3571,3592,3594,3605,3607,3613,3644,3649,3650,3666,3668,3958,4313,4436,4506,4590,4713]"
            ],
            16 =>  [
              "user_name" => "Lê Hải My",
              "user_id" => 2156,
              "total_transport_weight" => 42.2,
              "total_transport_m3" => 0.0,
              "total_transport_fee" => 1296600,
              "total_transport_weight_new_customer" => 0,
              "total_transport_fee_new_customer" => 0,
              "customer_id" => "[1074,1105,1230,1848,1865,1945,2036,2174,2175,2182,2186,2193,2208,2215,2218,2224,2227,2239,2249,2251,2262,2266,2278,2295,2300,2306,2329,2330,2333,2346,2355,2357,2359,2362,2363,2379,2398,2399,2400,2402,2430,2449,2468,2529,2530,2588,2595,2596,2621,2720,2728,2841,2850,2851,2852,2853,2854,2855,2856,2857,2862,2875,2911,2978,2991,3045,3052,3056,3057,3074,3075,3076,3077,3109,3149,3201,3257,3525,3719,3766]"
            ],
            17 =>  [
              "user_name" => "Đặng Thị Xuân",
              "user_id" => 2103,
              "total_transport_weight" => 3187.4,
              "total_transport_m3" => 0.272,
              "total_transport_fee" => 52501769,
              "total_transport_weight_new_customer" => 0,
              "total_transport_fee_new_customer" => 0,
              "customer_id" => "[1080,1094,1186,1193,1291,1301,1326,1338,1340,1408,1474,1475,1495,1517,1537,1558,1605,1633,1634,1644,1646,1653,1659,1661,1676,1689,1693,1704,1721,1754,1755,1779,1802,1830,1854,1892,1968,1972,1984,1995,2097,2109,2120,2129,2130,2131,2138,2139,2143,2153,2180,2210,2226,2231,2240,2245,2254,2275,2314,2328,2337,2356,2360,2371,2396,2408,2414,2432,2494,2586,2599,2615,2616,2638,2663,2665,2694,2700,2721,2745,2764,2773,2776,2789,2792,2827,2835,2864,2865,2869,2872,2905,2906,2915,2931,2935,2951,2959,2971,2989,2998,3051,3055,3068,3079,3089,3174,3186,3189,3312,3331,3345,3352,3367,3435,3510,3512,3529,3553,3624,3679,3700,3702,3709,3722,3848,3850,3879,3918,3920,3932,3950,3959,3985,4009,4048,4084,4086,4096,4113,4127,4129,4144,4179,4220,4249,4338,4340,4352,4384,4447,4532,4612,4627,4630,4637,4638,4659,4703]"
            ],
            18 =>  [
              "user_name" => "Ngô Ngân Giang",
              "user_id" => 2098,
              "total_transport_weight" => 389.2,
              "total_transport_m3" => 0.858,
              "total_transport_fee" => 17211600,
              "total_transport_weight_new_customer" => 0,
              "total_transport_fee_new_customer" => 0,
              "customer_id" => "[681,1446,1585,2116,2119,2126,2141,2145,2146,2148,2164,2172,2181,2191,2203,2223,2233,2244,2247,2267,2272,2277,2309,2322,2323,2338,2352,2353,2370,2380,2384,2387,2388,2394,2397,2418,2419,2425,2426,2427,2437,2453,2464,2476,2498,2505,2510,2516,2523,2525,2541,2544,2570,2573,2592,2593,2610,2664,2674,2737,2743,2751,2961,2966,2976,2987,2999,3013,3028,3094,3096,3182,3385,3423,3632,3786,3837,3868,3871,3872,3894,3966,4061,4078,4085,4091,4108,4163,4244,4250,4255,4301,4316,4321,4337,4397,4451,4555,4563]"
            ],
            19 =>  [
              "user_name" => "Nguyễn Minh Tú",
              "user_id" => 1931,
              "total_transport_weight" => 43.3,
              "total_transport_m3" => 0.0,
              "total_transport_fee" => 1235296,
              "total_transport_weight_new_customer" => 0,
              "total_transport_fee_new_customer" => 0,
              "customer_id" => "[657,1045,1141,1337,1436,1437,1519,1959,1986,2002,2004,2022,2023,2024,2025,2042,2043,2044,2049,2052,2064,2077,2100,2101,2110,2133,2134,2137,2140,2179,2195,2202,2248,2270,2291,2324,2340,2342,2350,2366,2376,2383,2392,2393,2405,2411,2420,2421,2441,2486,2487,2546,2560,2561,2567,2571,2572,2574,2651,2722,2822,2837,2974,3285,3292,3303,3458,3481,3502,3627]"
            ],
            20 =>  [
              "user_name" => "Trần Xuân Dũng",
              "user_id" => 1881,
              "total_transport_weight" => 2055.9,
              "total_transport_m3" => 2.412,
              "total_transport_fee" => 65295598,
              "total_transport_weight_new_customer" => 0,
              "total_transport_fee_new_customer" => 0,
              "customer_id" => "[1077,1089,1153,1242,1243,1356,1403,1569,1575,1629,1640,1677,1712,1775,1821,1907,1914,1946,1955,1957,1961,1964,1967,1969,1990,1993,2016,2027,2031,2038,2041,2045,2050,2054,2057,2058,2074,2080,2090,2095,2106,2107,2112,2123,2144,2162,2163,2165,2188,2198,2199,2200,2201,2206,2211,2219,2243,2246,2279,2286,2289,2290,2292,2293,2313,2347,2348,2354,2365,2378,2401,2410,2442,2448,2469,2483,2488,2496,2514,2528,2534,2538,2543,2555,2563,2566,2568,2576,2609,2612,2627,2628,2634,2648,2649,2650,2656,2658,2660,2677,2681,2684,2687,2689,2692,2698,2702,2740,2768,2775,2780,2795,2809,2819,2820,2828,2842,2843,2870,2917,2919,3044,3054,3066,3114,3150,3160,3172,3184,3254,3266,3295,3297,3304,3338,3343,3374,3390,3394,3402,3438,3486,3543,3568,3634,3654,3660,3661,3683,3828,3840,3951,3997,3998,4123,4128,4131,4132,4137,4178,4290,4304,4328,4370,4425,4515,4585,4596,4652,4672,4709]"
            ],
            21 =>  [
              "user_name" => "Phạm Kiều Trang",
              "user_id" => 1864,
              "total_transport_weight" => 1343.6,
              "total_transport_m3" => 5.751,
              "total_transport_fee" => 55659947,
              "total_transport_weight_new_customer" => 0,
              "total_transport_fee_new_customer" => 0,
              "customer_id" => "[468,1069,1837,1849,1855,1857,1861,1871,1878,1879,1883,1893,1899,1913,1962,1973,2005,2011,2059,2060,2061,2069,2071,2084,2104,2125,2160,2161,2221,2250,2263,2280,2304,2349,2364,2367,2374,2473,2490,2492,2502,2509,2512,2517,2521,2542,2547,2582,2584,2605,2606,2620,2685,2756,2757,2761,2762,2769,2770,2788,2790,2817,2876,2895,2897,2900,2902,2904,2912,2933,2945,2952,3003,3049,3070,3091,3100,3107,3140,3141,3142,3143,3203,3281,3286,3327,3328,3339,3377,3399,3419,3548,3633,3662,3721,3727,3771,3804,3866,3886,3892,3899,3917,3954,3969,4014,4021,4028,4029,4063,4151,4182,4200,4226,4279,4319,4327,4332,4379,4433]"
            ],
            22 =>  [
              "user_name" => "Lê Long Hải : 0971226601",
              "user_id" => 1423,
              "total_transport_weight" => 2730.5,
              "total_transport_m3" => 6.631,
              "total_transport_fee" => 96302746,
              "total_transport_weight_new_customer" => 0,
              "total_transport_fee_new_customer" => 0,
              "customer_id" => "[429,440,450,453,460,472,481,532,533,550,551,560,576,585,602,632,666,676,684,1002,1014,1015,1016,1019,1020,1021,1026,1028,1038,1047,1053,1056,1059,1067,1082,1086,1100,1102,1108,1119,1128,1148,1159,1173,1178,1183,1236,1272,1298,1307,1325,1350,1382,1383,1387,1411,1431,1498,1581,1606,1637,1641,1670,1680,1681,1686,1690,1719,1723,1726,1791,1794,1806,1820,1836,1858,1868,1869,1901,1920,1932,1950,1980,1981,2017,2028,2032,2035,2040,2102,2147,2167,2168,2217,2264,2273,2274,2282,2334,2369,2377,2428,2435,2491,2536,2590,2600,2629,2682,2686,2691,2713,2727,2749,2750,2772,2794,2802,2815,2816,2818,2834,2844,2903,2908,2960,3104,3111,3121,3181,3191,3202,3207,3351,3355,3356,3378,3412,3445,3461,3462,3463,3470,3476,3479,3480,3488,3542,3545,3652,3792,3877,3881,3890,3914,4008,4019,4214,4233,4277,4367,4389,4438,4575,4577,4595,4610,4629,4706]"
            ],
            23 =>  [
              "user_name" => "Trần Đức Hiếu",
              "user_id" => 1420,
              "total_transport_weight" => 2284.7,
              "total_transport_m3" => 1.777,
              "total_transport_fee" => 58857151,
              "total_transport_weight_new_customer" => 0,
              "total_transport_fee_new_customer" => 0,
              "customer_id" => "[443,490,501,682,683,1001,1007,1025,1027,1033,1035,1043,1044,1049,1050,1058,1060,1063,1066,1081,1083,1084,1090,1091,1093,1096,1118,1144,1150,1162,1192,1204,1237,1248,1273,1304,1316,1347,1352,1362,1364,1366,1393,1407,1420,1426,1429,1540,1568,1574,1580,1621,1623,1643,1648,1656,1657,1658,1678,1688,1692,1706,1714,1718,1720,1727,1728,1735,1738,1747,1750,1771,1778,1786,1792,1843,1882,1884,1894,1898,1902,1952,1954,1987,1998,2014,2026,2030,2037,2081,2085,2093,2169,2216,2225,2236,2237,2284,2288,2361,2385,2451,2524,2539,2578,2632,2657,2671,2678,2739,2765,2781,2814,2823,2892,2907,2949,2968,2984,3042,3069,3158,3227,3258,3289,3298,3417,3426,3446,3490,3620,3628,3667,3802,3865,3870,3883,3885,3924,3925,4022,4030,4051,4105,4110,4157,4199,4231,4270,4293,4378,4413,4462,4472,4539,4568,4588,4614,4720,4728]"
            ],
            24 =>  [
              "user_name" => "Lê Hồng Quang - 0981355988",
              "user_id" => 1190,
              "total_transport_weight" => 317.0,
              "total_transport_m3" => 0.737,
              "total_transport_fee" => 11698325,
              "total_transport_weight_new_customer" => 0,
              "total_transport_fee_new_customer" => 0,
              "customer_id" => "[1171,1190,1209,1617,1770,2082,2171,2287,2298,2310,2317,2318,2339,2341,2358,2403,2404,2409,2415,2422,2440,2465,2474,2480,2482,2484,2513,2515,2518,2520,2522,2559,2630,2631,2641,2654,2676,2693,2742,2747,2791,2801,2805,2806,2811,2825,2930,2934,2970,2994,3108,3210,3238,3424,3583,3586,3637,3640,3665,3701,3717,3720,3744,3762,3775,3776,3777,3779,3789,3807,3809,3822,3858,3882,3888,3963,3993,4073,4305]"
            ],
            25 =>  [
              "user_name" => "Kim Nhật Lệ",
              "user_id" => 1034,
              "total_transport_weight" => 202.4,
              "total_transport_m3" => 0.0,
              "total_transport_fee" => 5697599,
              "total_transport_weight_new_customer" => 0,
              "total_transport_fee_new_customer" => 0,
              "customer_id" => "[1008,1011,1046,1048,1132,1134,1135,1140,1156,1220,1250,1265,1286,1390,1410,1443,1470,1499,1500,1505,1548,1598,1703,1729,1796,2091,2190,2192,2194,2646,2725,2726,2848,2858,3006,3073,3083,3084,3135,3250,3256,3301,3314,3603,3793,3973,3983,3999,4046,4056,4067,4069,4079,4145,4545]"
            ],
            26 =>  [
              "user_name" => "Ngọc Huyền 0983837261",
              "user_id" => 503,
              "total_transport_weight" => 1550.9,
              "total_transport_m3" => 3.346,
              "total_transport_fee" => 52794598,
              "total_transport_weight_new_customer" => 0,
              "total_transport_fee_new_customer" => 0,
              "customer_id" => "[474,652,1006,1012,1022,1072,1073,1075,1092,1095,1097,1121,1131,1136,1145,1146,1168,1174,1179,1214,1221,1254,1270,1289,1296,1312,1324,1335,1354,1355,1363,1370,1373,1378,1381,1394,1417,1438,1447,1476,1485,1487,1491,1492,1494,1501,1504,1509,1514,1518,1526,1529,1533,1539,1546,1547,1577,1579,1593,1612,1615,1616,1619,1632,1635,1645,1663,1674,1682,1683,1691,1702,1707,1708,1709,1713,1731,1732,1736,1742,1749,1757,1759,1760,1769,1774,1776,1777,1782,1801,1810,1838,1844,1847,1850,1875,1880,1885,1896,1903,1905,1910,1918,1921,1922,1925,1935,1936,1953,1958,1960,1963,1965,1966,1982,1985,1988,1997,2003,2006,2010,2065,2070,2083,2092,2096,2099,2113,2114,2136,2142,2152,2166,2183,2207,2209,2230,2238,2255,2258,2259,2276,2294,2301,2302,2312,2326,2331,2343,2345,2381,2406,2407,2413,2423,2429,2431,2433,2438,2439,2446,2455,2457,2459,2467,2470,2477,2485,2489,2499,2501,2506,2507,2533,2537,2549,2553,2564,2575,2579,2580,2581,2583,2585,2589,2598,2601,2603,2608,2617,2623,2645,2659,2668,2695,2706,2716,2733,2735,2752,2777,2803,2826,2830,2847,2860,2863,2868,2877,2884,2896,2913,2914,2925,2953,2954,2955,2977,2996,3022,3029,3046,3058,3061,3080,3092,3095,3099,3110,3125,3129,3138,3139,3162,3177,3183,3196,3200,3204,3206,3211,3213,3220,3237,3246,3260,3262,3267,3275,3279,3315,3321,3360,3362,3370,3373,3379,3383,3384,3430,3441,3443,3453,3472,3475,3494,3505,3506,3507,3508,3516,3518,3554,3556,3569,3591,3593,3598,3602,3612,3629,3630,3642,3678,3690,3691,3692,3693,3711,3714,3724,3729,3734,3735,3736,3743,3760,3770,3780,3796,3800,3803,3812,3814,3841,3844,3851,4018,4027,4191,4197,4251,4281,4282,4326,4399,4405,4412,4414,4495,4507,4565,4576,4598,4607,4633,4660,4694,4711,4722]"
            ]
        ];

        foreach ($data as $value) {
            $report = ReportDetail::where('user_id', $value['user_id'])
            ->where('sale_report_id', 19)
            ->first();

            $report->total_transport_weight = $value['total_transport_weight'];
            $report->total_transport_m3 = $value['total_transport_m3'];
            $report->total_transport_fee = $value['total_transport_fee'];
            $report->total_transport_weight_new_customer = $value['total_transport_weight_new_customer'];
            $report->total_transport_fee_new_customer = $value['total_transport_fee_new_customer'];
            $report->customer_ids = $value['customer_id'];
            $report->save();
        }
        // $sale_user = User::find(1423);

        // $customers = $sale_user->saleCustomers();

        // // dd($customers->count());
        // $customer_ids = $customers->pluck('id');

        // $payment_orders_1 = PaymentOrder::whereIn('payment_customer_id', $customer_ids)
        // ->where('status', 'payment_export')
        // ->where('created_at', '>=', "2021-10-01 00:00:01")->where('created_at', '<=', "2021-10-31 23:59:59")
        // ->get();

        // // $total_transport_weight = TransportCode::whereIn('order_id', $payment_orders_1->pluck('id'))->sum('kg');

        // // dd($total_transport_weight);
        // $payment_orders_2 = PaymentOrder::whereIn('payment_customer_id', $customer_ids)
        // // ->where('status', 'cancel')
        // ->where('status', 'payment_export')
        // ->where('export_at', '>=', "2021-10-01 00:00:01")->where('export_at', '<=', "2021-10-31 23:59:59")
        // ->get();

        // $diff = array_diff($payment_orders_1->pluck('id')->toArray(), $payment_orders_2->pluck('id')->toArray());

        // // $cancel = PaymentOrder::whereIn('id', $diff)->where('status', 'cancel')->get();
        // // dd($cancel);
        // // dd($payment_orders_2->count());
        // $correct = PaymentOrder::whereIn('payment_customer_id', $customer_ids)
        // ->where('payment_customer_id', '!=', 2313)
        // ->where('status', 'payment_export')
        // ->where('export_at', '>=', "2021-10-01 00:00:01")->where('export_at', '<=', "2021-10-31 23:59:59")
        // ->get();


        // echo "\n- Đơn lấy theo ngày tạo: " . $payment_orders_1->count() . " - Tổng tiền: " . number_format($payment_orders_1->sum('amount'));
        // echo "\n- Đơn lấy theo ngày xuất kho: " . $payment_orders_2->count() . " - Tổng tiền: " . number_format($payment_orders_2->sum('amount'));
        // echo "\n- Đơn lấy theo ngày xuất kho , đã trừ khách bongvit do 2.11 chuyển cho Trần Xuân Dũng: " . $correct->count() . " - Tổng tiền: " . number_format($correct->sum('amount'));
        // dd("\n");
        // $orders = PaymentOrder::where('created_at', '>=', '2021-08-01 00:00:01')
        //     ->where('warehouse_id', 0)
        //     ->where('status', '!=', 'cancel')
        //     // ->where('order_number', 'B7685')
        //     ->with('transportCode')
        //     ->get();

        
        // foreach ($orders as $key => $order) {
        //     // dd($order);
        //     if ($order->transportCode->count() > 0) {

        //         try {
        //             echo $key+1 . " -- ";
        //             echo $order->order_number . " \t";

        //             $ware_house_id = 0;

        //             // dd($order->transportCode);
        //             foreach ($order->transportCode as $transportCode) {
        //                 if ($transportCode->ware_house_id != null) {
        //                     $ware_house_id = $transportCode->ware_house_id;
        //                 }
        //             }


        //             // $ware_house_id = $order->transportCode->where('ware_house_id', '!=', null)->first()->ware_house_id;
        //             echo $ware_house_id . "\n";
        //             $order->warehouse_id = $ware_house_id;
        //             $order->save();
        //         } catch (\Exception $e) {
        //             dd($e->getMessage());
        //             dd($order->transportCode);
        //         }
        //     }
           
        // }

        // dd('oke');
        // $orders = PurchaseOrder::where('status', 9)
        //                 ->where('success_at', '>=', "2021-10-01 00:00:01")
        //                 ->where('success_at', '<=', "2021-10-31 23:59:59")
        //                 ->with('items')
        //                 ->get();
        
        // $total = 0;
        // $note = [];
        // foreach ($orders as $key => $order) {
        //     $amount = number_format(str_replace(",", '', $order->amount()), 2, '.', '') ;
        //     $amount_vnd = $amount * $order->current_rate;
        //     $total += $amount_vnd;

        //     $note[] = ($key+1). " - ". $order->order_number . " - Tệ: " . $amount . " - Tỷ giá: " . $order->current_rate . " - VND: " . number_format($amount_vnd) . "\n";
        // }

        // Storage::disk('admin')->put('don_hang_thanh_cong_trong_thang_10.txt', $note);

        // dd(number_format($total));

        // $orders = PaymentOrder::whereStatus('payment_export')
        //     ->whereNull('export_at')
        //     ->get();

        //     dd($orders->count());
        // $temp = $orders->pluck('id')->toArray();

        // $orders = PaymentOrder::whereStatus('payment_export')
        //     ->whereBetween('created_at', ['2021-09-01', '2021-10-01'])
        //     // ->whereColumn('created_at','!=', 'updated_at')
        //     // ->whereNotNull('export_at')
        //     ->get();

        //     $temp2 = $orders->pluck('id')->toArray();
        // // foreach ($orders as $order) {
        // //     dd($order);
        // // }
        // dd(array_diff($temp2, $temp));
        // dd($orders->count());
        // dd($orders->sum('amount'));
        // $deposited = "245949";
        // $deposited_final = (int) floor($deposited /1000);

        //     $deposited_final *= 1000;
        //     dd($deposited_final);
        // $orderService = new OrderService();

        // $order = PurchaseOrder::find(21152);

        // // if ($order->status == $orderService->getStatus('new-order')) {

        // // amount item price
        //     $totalItemPrice = str_replace(',', '', $order->sumItemPrice());

        //     $percent = 70;
        //     $depositedRmb = $totalItemPrice / 100 * $percent;
        //     $depositedVnd = $depositedRmb * $order->current_rate;
        //     $deposited = number_format($depositedVnd, 0, '.', '');

        //     $deposited = floor($deposited/1000);
        //     $deposited *= 1000;
        //     $deposited = (int) $deposited;

        //     dd($deposited);

        //     $order->status = $orderService->getStatus('deposited');
        //     $order->deposited = $deposited;
        //     $order->deposited_at = now();
        //     $order->user_deposited_at = $this->user_created_id;
        //     $order->save();

        //     $job = new HandleCustomerWallet(
        //         $order->customer->id,
        //         $this->user_created_id, // admin
        //         $deposited,
        //         3,
        //         "Đặt cọc đơn hàng mua hộ $order->order_number"
        //     );
        //     dispatch($job);
        // }


        // $orders = PaymentOrder::whereStatus('cancel')->whereNotNull('transaction_note')->get();

        // $notes = $orders->pluck('transaction_note');

        // Transaction::whereIn('content', $notes)->delete();
        // // dd($transaction->count());
        // dd('oke');
        // $orders = PurchaseOrder::whereNotIn('final_payment', ["", 0])->where('created_at', 'like', '2021-09%')
        //     ->whereNotNull('final_payment')->orderBy('id', 'desc')->get();
        // dd($orders->count());
        // foreach ($orders as $order ) {
        //     echo $order->order_number."\n";

        //     $price_rmb = str_replace(",", "", $order->sumItemPrice());
        //     $ship = $order->sumShipFee();

        //     $amount = $price_rmb + $ship;

        //     $final_payment = str_replace(",", "", $order->final_payment);
                
        //     $order->offer_cn = number_format($amount - $final_payment, 2);
        //     $order->offer_vn = number_format(($amount - $final_payment) * $order->current_rate, 0);
        //     $order->save();
        // }
        // $total_vnd = 0;
        // $deposited = $orders->sum('deposited');

        // foreach ($orders as $order){
        //     $amount = (float) str_replace(",","", $order->sumItemPrice());
        //     $total_vnd = $amount * $order->current_rate;
        //     echo $order->id . "---" . number_format($total_vnd, 0) . "---" . number_format($order->deposited, 0) ."\n";
        // }
        
        // $money = rand(1000, 13000000);
        // $money = 3450;
        // // if ()
        // echo $money . "\n";
        // $money = floor($money/1000);
        // $money *= 1000;
        // $money = (int) $money;

        // dd($money);

        // $olds = AlilogiTransaction::where('customer_id', 1043)->get();

        // foreach ($olds as $transaction) {
        //     $flag = Transaction::where('customer_id', $transaction->customer_id)
        //         ->where('content', 'like', '%'.$transaction->content)
        //         ->get();
            
        //     if (! $flag->count() > 0) {

        //         echo $transaction->id . "\n";
        //     }
        // }

        // dd($olds->count());

        // $transactions = Transaction::where('content', 'like', '%ship%')
        //     ->orWhere('content', 'like', '%SHIP%')
        //     ->get();

        // foreach ($transactions as $transaction) {
        //     $old = AlilogiTransaction::where('content', $transaction->content)->first();

        //     $transaction->created_at = $old->created_at;
        //     $transaction->save();
        // }
        // $users = User::select('id', 'symbol_name', 'wallet')->whereIsCustomer(1)->get();
        // $ids = [];
        // foreach ($users as $user) {
        //     $service = new UserService();
        //     $data = $service->GetCustomerTransactionHistory($user->id, false);

        //     if (isset($data[0]) && $data[0]['after_payment'] != $user->wallet) {
        //         echo $user->id . " --- ";
        //         echo $user->symbol_name . " --- ";
        //         echo $user->wallet . " --- ";
        //         echo $data[0]['after_payment'] ."\n";

        //         $user->wallet = number_format($data[0]['after_payment'], 0, '.', '');
        //         $user->save();
        //     } else {
        //         echo $user->id. "-- done\n";
        //     }

        // }

        // dd($ids);
        // $code = [
        //     'KANGNAM',
        //     'LHTHU95',
        //     'UYEN230',
        //     'TRANGXUAN',
        //     'DUONG341',
        //     'VYVY',
        //     'KHONGTEN',
        //     'NAM85',
        //     'ALTKIEN',
        //     'ALKIMANH',
        //     'ALBQ95',
        //     'ALNINA',
        //     'ALTUAN2292',
        //     'ALMRSTHAO',
        //     'nguyet1808',
        //     'Yumi',
        //     'TXdothinga',
        //     'MinhChang',
        //     'HN.MEN',
        //     'xuanthanhfb',
        //     'MC95',
        //     'TXhieuvu',
        //     'Thuyvan96',
        //     'GIANGMUN',
        //     'HAU36',
        //     'nguyenhien02',
        //     'Huyen245',
        //     'Thuhien48',
        //     'Zangg',
        //     'TXAROOM',
        //     'TXvuan',
        //     'TXbaongoc95',
        //     'uyen264',
        //     'hienpham87',
        //     'Khanhly274',
        //     'Havy97',
        //     'KhLinh973',
        //     'thu123',
        //     'nga2003'
        // ];

        // $old_users = AlilogiUser::whereIsCustomer(1)->whereIn('symbol_name', $code)->get();

        // $key = 1;
        // $temp = 0;

        // $all = [];
        // foreach ($old_users as $key => $user) {
        //     // echo ($key+1) . ". ".$user->symbol_name . " --- Số dư hiện tại: " . number_format($user->wallet) . "\n";
        //     $user_id = $user->id;
        //     $old_transactions = AlilogiTransaction::whereCustomerId($user_id)->get();
        //     $new_transactions = Transaction::whereCustomerId($user_id)->get();

        //     $old_contents = $old_transactions->pluck('content', 'id');
        //     $new_contents = $new_transactions->pluck('content', 'id');

        //     $diff = array_diff($old_contents->toArray(),$new_contents->toArray());

        //     if (sizeof($diff) > 0) {
        //         foreach ($diff as $transaction_id => $transaction) {
        //             $flag = Transaction::where('content', $transaction)->first();

        //             if ($flag) {
        //                 echo "-- Đã tồn tại \n";

        //                 echo $transaction_id . "-". $transaction;


        //             } else {

        //                 // echo "-- Chưa tồn tại \n";

        //                 // $raw = AlilogiTransaction::find($transaction_id);

        //                 // Transaction::create($raw->toArray());
        //             }
        //         }
        //     }
            // foreach ($old_content)


            // if (sizeof ($result) > 0) {
            //     $key_row = 0;
            //     foreach ($result as $content) {
            //         $res = AlilogiTransaction::where('content', $content)->first();
            //         $flag = Transaction::where('content', $content)->first();
            //         if (! $flag) {
            //             // chua ton tai trong data moi

            //             $temp++;
            //             // $all[] = $old_record_id;
            //             // echo " --- Chưa tồn tại\n";

            //             // $create = $res->toArray();
            //             // $create['note'] = $create['id'];

            //             // dd($create);
            //             // Transaction::create($create);

            //         //     dd('okd');
            //         } 
                    
            //         else {
            //         //     $all[] = $old_record_id;

            //         echo ($key+1) . "." . ($key_row+1) . ". ".$res->id."/" . $res->content . " --- " . number_format($res->money) . " --- " . $res->created_at;
            //             echo " --- Đã tồn tại\n";
            //         }
            //         $key_row++;
            //     }
            //     // echo $key . " --- ". $user->symbol_name . " --- " . json_encode($result) . "\n";
            //     $key++;
            // }

            // echo "------------------------\n";
        

    }
}



// 1. KANGNAM --- -89,639,910
// 2. LHTHU95 --- -528,300
// 3. UYEN230 --- -1,196,700
// 4. TRANGXUAN --- -414,300
// 5. DUONG341 --- -1,691,170
// 6. VYVY --- -12,748,300
// 7. KHONGTEN --- 0
// 8. NAM85 --- -2,258,725
// 9. ALTKIEN --- -71,170,084
// 10. ALKIMANH --- 6,810,215
// 11. ALBQ95 --- -1,294,487
// 12. ALNINA --- 5,608,946
// 13. ALTUAN2292 --- -10,641,928
// 14. ALMRSTHAO --- 256,136
// 15. nguyet1808 --- -48,848
// 16. Yumi --- 894,564
// 17. TXdothinga --- -270,760
// 18. MinhChang --- -510,200
// 19. HN.MEN --- 125,902
// 20. xuanthanhfb --- -4,387,438
// 21. MC95 --- -1,063,243
// 22. TXhieuvu --- 408,038
// 23. Thuyvan96 --- 245,131
// 24. GIANGMUN --- -1,696,200
// 25. HAU36 --- -3,369,400
// 26. nguyenhien02 --- 1,385
// 27. Huyen245 --- 213,260
// 28. Thuhien48 --- -8,317,675
// 29. Zangg --- 1,642,079
// 30. TXAROOM --- 577
// 31. TXvuan --- 59,080
// 32. TXbaongoc95 --- -48,643,224
// 33. uyen264 --- 600
// 34. hienpham87 --- 1,274
// 35. Khanhly274 --- -660,262
// 36. Havy97 --- 479
// 37. KhLinh973 --- 700
// 38. thu123 --- -120,739
// 39. nga2003 --- -6,647,609